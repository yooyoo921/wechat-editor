<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬ä¼—å·æ’ç‰ˆå¤§å¸ˆ - ä¸“ä¸šç‰ˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/juice/9.1.0/juice.min.js"></script>
    
    <style>
        /* --- ç•Œé¢åŸºç¡€æ ·å¼ --- */
        :root { --primary: #07c160; --bg: #f5f7fa; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: var(--bg); color: #333; height: 100vh; display: flex; flex-direction: column; }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .navbar { background: white; padding: 1rem 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .logo { font-size: 1.25rem; font-weight: 800; color: #333; display: flex; align-items: center; gap: 8px; }
        .logo span { color: var(--primary); }
        
        /* æŒ‰é’®ç»„ */
        .btn-group { display: flex; gap: 10px; }
        .btn { padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; font-size: 0.95rem; display: flex; align-items: center; gap: 6px; }
        .btn-outline { background: white; border: 1px solid #ddd; color: #666; }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(7, 193, 96, 0.3); }
        .btn-primary:hover { background: #06ad56; transform: translateY(-1px); }
        .btn-primary:active { transform: translateY(0); }

        /* ä¸»å¸ƒå±€ */
        .main-layout { flex: 1; display: flex; padding: 20px; gap: 20px; overflow: hidden; max-width: 1400px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        
        /* å·¦ä¾§æ“ä½œåŒº */
        .editor-panel { flex: 1; display: flex; flex-direction: column; gap: 15px; background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); min-width: 0; }
        
        /* é£æ ¼é€‰æ‹©å™¨ */
        .theme-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-bottom: 10px; }
        .theme-card { border: 2px solid #eee; padding: 10px; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .theme-card:hover { border-color: #b7ebc9; }
        .theme-card.active { border-color: var(--primary); background: #f0fdf4; color: var(--primary); font-weight: bold; }
        
        /* è¾“å…¥æ¡† */
        .input-wrapper { flex: 1; position: relative; border: 1px solid #eee; border-radius: 12px; overflow: hidden; }
        textarea { width: 100%; height: 100%; border: none; padding: 20px; resize: none; outline: none; font-size: 16px; line-height: 1.6; font-family: monospace; box-sizing: border-box; }
        
        /* å³ä¾§é¢„è§ˆåŒº */
        .preview-panel { width: 400px; display: flex; justify-content: center; align-items: flex-start; flex-shrink: 0; }
        .iphone { width: 375px; height: 100%; max-height: 750px; background: white; border: 14px solid #2d3436; border-radius: 40px; position: relative; display: flex; flex-direction: column; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); overflow: hidden; }
        .iphone-notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 24px; background: #2d3436; border-bottom-left-radius: 16px; border-bottom-right-radius: 16px; z-index: 20; }
        .wx-header { height: 44px; background: #f7f7f7; border-bottom: 1px solid #ebedf0; margin-top: 24px; display: flex; align-items: center; justify-content: center; font-size: 15px; font-weight: 600; color: #333; flex-shrink: 0; }
        .preview-content { flex: 1; overflow-y: auto; padding: 20px; background: #fff; }
        .preview-content::-webkit-scrollbar { width: 6px; }
        .preview-content::-webkit-scrollbar-thumb { background: #ddd; border-radius: 3px; }

        /* éšè—çš„æ–‡ä»¶ä¸Šä¼  */
        #fileInput { display: none; }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 900px) {
            .main-layout { flex-direction: column; overflow-y: auto; }
            .preview-panel { width: 100%; align-items: center; }
            .iphone { height: 600px; }
        }
    </style>
</head>
<body>
    <div id="app">
        <nav class="navbar">
            <div class="logo">âœ¨ å…¬ä¼—å·<span>æ’ç‰ˆå¤§å¸ˆ</span></div>
            <div class="btn-group">
                <button class="btn btn-outline" @click="triggerFileUpload">
                    ğŸ“‚ å¯¼å…¥æ–‡ç¨¿ (TXT/MD)
                </button>
                <input type="file" id="fileInput" accept=".txt,.md" @change="handleFileUpload">
                
                <button class="btn btn-primary" @click="copyHtml">
                    ğŸš€ å¤åˆ¶åˆ°å…¬ä¼—å·
                </button>
            </div>
        </nav>

        <div class="main-layout">
            <div class="editor-panel">
                <label style="font-weight:bold; color:#666;">é€‰æ‹©æ’ç‰ˆé£æ ¼ï¼š</label>
                <div class="theme-grid">
                    <div v-for="(t, key) in themes" :key="key" 
                         class="theme-card" :class="{ active: currentTheme === key }"
                         @click="setTheme(key)">
                        {{ t.name }}
                    </div>
                </div>
                
                <div class="input-wrapper">
                    <textarea v-model="input" @input="renderHtml" placeholder="åœ¨æ­¤è¾“å…¥æ–‡å­—ï¼Œæˆ–ç‚¹å‡»ä¸Šæ–¹â€œå¯¼å…¥æ–‡ç¨¿â€æŒ‰é’®..."></textarea>
                </div>
                <div style="font-size: 12px; color: #999; text-align: right;">æ”¯æŒ Markdown è¯­æ³•</div>
            </div>

            <div class="preview-panel">
                <div class="iphone">
                    <div class="iphone-notch"></div>
                    <div class="wx-header">å…¬ä¼—å·é¢„è§ˆ</div>
                    <div id="wx-preview" class="preview-content" v-html="output"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const input = ref('## æ¬¢è¿ä½¿ç”¨æ’ç‰ˆå¤§å¸ˆ\n\nç‚¹å‡»ä¸Šæ–¹çš„ **â€œå¯¼å…¥æ–‡ç¨¿â€** æŒ‰é’®ï¼Œå¯ä»¥ç›´æ¥æ‰“å¼€ç”µè„‘é‡Œçš„ TXT æ–‡ä»¶ã€‚\n\n> è¿™æ˜¯ä¸€ä¸ªâ€œå¡ç‰‡å¼â€å¼•ç”¨å—ï¼Œæ¯”å¾®ä¿¡åŸç”Ÿçš„å¥½çœ‹å¤šäº†ã€‚\n\nè¯•è¯•ç‚¹å‡»ä¸Šé¢çš„ä¸åŒé£æ ¼ï¼Œçœ‹çœ‹æ•ˆæœï¼');
                const output = ref('');
                const currentTheme = ref('life');

                // --- æ ¸å¿ƒï¼šé«˜çº§æ ·å¼åº“ (CSSå†™åœ¨JSé‡Œï¼Œç¡®ä¿å¤åˆ¶æœ‰æ•ˆ) ---
                const themes = {
                    life: { 
                        name: 'ğŸŒ» ç”Ÿæ´»å¡ç‰‡', 
                        css: `
                            .wx-content { font-size: 16px; color: #333; line-height: 1.8; text-align: justify; }
                            /* æ ‡é¢˜ï¼šé»„è‰²èƒŒæ™¯å— */
                            h2 { display: table; background: #fff7e6; color: #d46b08; padding: 8px 15px; border-radius: 6px; margin: 30px 0 15px 0; font-size: 17px; font-weight: bold; }
                            /* å¼•ç”¨ï¼šå¡ç‰‡é£æ ¼ */
                            blockquote { background: white; border-left: 5px solid #ffa940; padding: 15px; margin: 20px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-radius: 4px; color: #666; }
                            strong { color: #d46b08; background: rgba(255, 169, 64, 0.15); padding: 0 2px; }
                        `
                    },
                    tech: { 
                        name: 'ğŸ’» ç§‘æŠ€å•†åŠ¡', 
                        css: `
                            .wx-content { font-size: 16px; color: #333; line-height: 1.7; text-align: justify; }
                            /* æ ‡é¢˜ï¼šå·¦ä¾§è“çº¿ */
                            h2 { border-left: 6px solid #1890ff; padding-left: 12px; background: linear-gradient(to right, #e6f7ff, transparent); margin: 30px 0 15px; font-size: 18px; color: #003a8c; padding-top: 5px; padding-bottom: 5px; }
                            /* å¼•ç”¨ï¼šç§‘æŠ€ç° */
                            blockquote { background: #f0f2f5; border: 1px solid #d9d9d9; padding: 15px; border-radius: 4px; color: #595959; font-size: 15px; }
                            strong { color: #1890ff; font-weight: bold; }
                        `
                    },
                    bubble: { 
                        name: 'ğŸŸ¢ æç®€æ°”æ³¡', 
                        css: `
                            .wx-content { font-size: 16px; color: #333; line-height: 1.8; }
                            /* æ ‡é¢˜ï¼šç»¿è‰²æ°”æ³¡ */
                            h2 { display: inline-block; background: #07c160; color: white; padding: 6px 18px; border-radius: 20px; margin: 30px 0 15px; font-size: 16px; box-shadow: 0 4px 6px rgba(7, 193, 96, 0.2); }
                            blockquote { border: 2px dashed #07c160; background: #f6ffed; padding: 15px; border-radius: 8px; color: #333; }
                            strong { color: #07c160; border-bottom: 2px solid #07c160; }
                        `
                    },
                    art: { 
                        name: 'ğŸ¨ æ–‡è‰ºç•™ç™½', 
                        css: `
                            .wx-content { font-size: 16px; color: #555; line-height: 2.0; text-align: center; }
                            /* æ ‡é¢˜ï¼šä¸Šä¸‹çº¿æ¡ */
                            h2 { color: #722ed1; margin: 40px 0 20px; font-weight: normal; border-top: 1px solid #d3adf7; border-bottom: 1px solid #d3adf7; padding: 10px 0; display: inline-block; min-width: 50%; letter-spacing: 2px; }
                            blockquote { color: #722ed1; font-family: serif; font-style: italic; margin: 30px 20px; }
                            strong { color: #722ed1; font-weight: normal; }
                            p { margin-bottom: 2em; }
                        `
                    }
                };

                // æ ¸å¿ƒæ¸²æŸ“é€»è¾‘
                const renderHtml = () => {
                    if (typeof marked === 'undefined' || typeof juice === 'undefined') return;
                    
                    const rawHtml = marked.parse(input.value);
                    const themeCss = themes[currentTheme.value].css;
                    
                    // åŸºç¡€å›¾ç‰‡é€‚é…æ ·å¼
                    const baseCss = `img { max-width: 100% !important; height: auto !important; border-radius: 6px; margin: 10px 0; display: block; }`;
                    
                    // ä½¿ç”¨ Juice å†…è”æ ·å¼
                    const fullHtml = `<div class="wx-content">${rawHtml}</div>`;
                    output.value = juice.inlineContent(fullHtml, baseCss + themeCss);
                };

                const setTheme = (key) => {
                    currentTheme.value = key;
                    renderHtml();
                };

                // --- æ–°åŠŸèƒ½ï¼šå¯¼å…¥æ–‡ä»¶ ---
                const triggerFileUpload = () => {
                    document.getElementById('fileInput').click();
                };

                const handleFileUpload = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        input.value = e.target.result; // å°†æ–‡ä»¶å†…å®¹å¡«å…¥è¾“å…¥æ¡†
                        renderHtml(); // é‡æ–°æ¸²æŸ“
                    };
                    reader.readAsText(file); // è¯»å–ä¸ºæ–‡æœ¬
                    
                    // æ¸…ç©º input å…è®¸é‡å¤ä¸Šä¼ åŒåæ–‡ä»¶
                    event.target.value = '';
                };

                // --- å¤åˆ¶åŠŸèƒ½ ---
                const copyHtml = async () => {
                    const el = document.getElementById('wx-preview');
                    try {
                        const blob = new Blob([el.innerHTML], { type: 'text/html' });
                        await navigator.clipboard.write([new ClipboardItem({ 'text/html': blob })]);
                        alert('âœ… å¤åˆ¶æˆåŠŸï¼\n\nç°åœ¨å»å…¬ä¼—å·åå°ï¼ŒæŒ‰ Ctrl+V ç²˜è´´å³å¯çœ‹åˆ°æ•ˆæœã€‚');
                    } catch (err) {
                        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å…¨é€‰å³ä¾§å†…å®¹å¤åˆ¶ã€‚');
                    }
                };

                onMounted(() => {
                    setTimeout(renderHtml, 300); // å»¶è¿Ÿæ¸²æŸ“ç¡®ä¿åº“åŠ è½½
                });

                return { input, output, themes, currentTheme, setTheme, renderHtml, copyHtml, triggerFileUpload, handleFileUpload };
            }
        }).mount('#app');
    </script>
</body>
</html>
